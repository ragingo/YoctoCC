# Yoctocc テストフレームワーク

このディレクトリには、chibiccスタイルのユニットテスト機構が含まれています。

## 使用方法

### テストの実行

プロジェクトルートから以下のコマンドを実行:

```bash
make test
```

または、直接スクリプトを実行:

```bash
./test/run_tests.sh
```

### テストの追加

`test/tests.conf` に新しいテストケースを追加します。

**フォーマット**: `<期待される終了コード> <コード>`

**例**:
```
42 { return 42; }
8 { a=3; z=5; return a+z; }
3 { if (1) return 3; return 2; }
```

テストを実行:
```bash
make test
```

## ファイル構成

- `tests.conf` - テストケースの設定ファイル
- `run_tests.sh` - テスト実行スクリプト
- `test1.txt`, `test2.txt`, ... - 各テストケースの入力ファイル
- `README.md` - このファイル

## tests.conf の書式

```
# コメント行は '#' で始まる
# 空行は無視される

<テストファイル> <期待される終了コード> <説明(オプション)>
```

例:
```
test/test1.txt 100 "基本的な式と制御構文のテスト"
test/test2.txt 0 "正常終了のテスト(return 0)"
test/test3.txt 1 "return 1のテスト"
```

## 出力例

```
========================================
      Yoctocc テストスイート
========================================

コンパイラをビルド中...
コンパイラのビルドが完了しました

テスト #1: test/test1.txt
  説明: 基本的な式と制御構文のテスト
  ✓ PASSED: 終了コード 100 (期待値: 100)

テスト #2: test/test2.txt
  説明: 正常終了のテスト(return 0)
  ✓ PASSED: 終了コード 0 (期待値: 0)

========================================
      テスト結果サマリー
========================================
総テスト数:   2
成功:         2
失敗:         0

すべてのテストが成功しました!
```

## 終了コード

- `0` - すべてのテストが成功
- `1` - 一部またはすべてのテストが失敗

## Tips

- テストファイルの期待値を確認するには:
  ```bash
  make clean; make INPUT=test/testX.txt; make run; echo $?
  ```

- 個別のテストファイルをデバッグするには:
  ```bash
  make clean
  make INPUT=test/testX.txt
  cat ./build/program.asm  # アセンブリを確認
  make run
  echo $?                   # 終了コードを確認
  ```
